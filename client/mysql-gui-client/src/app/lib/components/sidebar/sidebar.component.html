<div class="h-screen overflow-hidden bg-gray-400">
    <div class="ml-2 text-sm">Navigator</div>
    <div class="h-[calc(100%-2rem)] bg-gray-100 dark:bg-gray-900">
        <div class="mb-1 flex items-center justify-between p-2 text-sm font-semibold">
            <span>SCHEMAS</span>
            <button
                class="text-md ml-2 mr-2"
                (click)="refresh()"
            >
                <span [ngClass]="'icon-[fa--refresh]'"></span>
            </button>
        </div>
        <div class="p-2">
            <span
                class="text-md mr-2"
                [ngClass]="'icon-[fa--search]'"
            ></span>
            <input
                class="mb-4 h-8 rounded border focus:border-blue-300 focus:outline-none focus:ring"
                type="text"
                placeholder="Filter objects"
            />
            <ng-template #loading>
                <div>Loading...</div>
            </ng-template>
        </div>

        <div class="h-[80vh] overflow-auto">
            <div
                class="pb-2 pl-2 scrollbar-thin scrollbar-track-gray-200 scrollbar-thumb-gray-500"
                *ngIf="databases['databases']; else loading"
            >
                <div *ngIf="databases['databases']; else loading">
                    <div
                        class="mb-2"
                        *ngFor="let database of databases?.databases; let i = index"
                    >
                        <div
                            class="flex cursor-pointer items-center"
                            (click)="toggleSection(database)"
                        >
                            <span class="mr-1">
                                <ng-container *ngIf="isOpen(database); else closed">
                                    <span
                                        class="text-md mr-2"
                                        [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                    ></span>
                                </ng-container>
                                <ng-template #closed>
                                    <span
                                        class="text-md mr-2"
                                        [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                    ></span>
                                </ng-template>
                            </span>
                            <span>{{ database }}</span>
                        </div>

                        <div
                            *ngIf="isOpen(database)"
                            class="ml-4"
                        >
                            <div
                                class="flex cursor-pointer items-center"
                                (click)="toggleSection(database+'_tables')"
                            >
                                <span class="mr-1">
                                    <ng-container *ngIf="isOpen(database+'_tables'); else closedTable">
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                        ></span>
                                    </ng-container>
                                    <ng-template #closedTable>
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                        ></span>
                                    </ng-template>
                                </span>
                                <span>Tables</span>
                            </div>
                            <ul
                                *ngIf="isOpen(database+'_tables')"
                                class="ml-4 list-none"
                            >
                                <li
                                    *ngFor="let table of tables['tables']; let i = index"
                                    class="mb-1"
                                >
                                    <div
                                        class="flex cursor-pointer items-center"
                                        (click)="toggleSection(database+'_tables')"
                                    >
                                        <span class="mr-1">
                                            <ng-container
                                                *ngIf="
                                                    isOpen(database+'_tables');
                                                    else closedTable
                                                "
                                            >
                                                <span
                                                    class="text-md mr-2"
                                                    [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                                ></span>
                                            </ng-container>
                                            <ng-template #closedTable>
                                                <span
                                                    class="text-md mr-2"
                                                    [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                                ></span>
                                            </ng-template>
                                        </span>
                                        <span class="flex items-center justify-between">
                                            {{ table }}
                                            <span
                                                class="text-md mr-5 opacity-50 transition-opacity duration-300 hover:opacity-100"
                                                [ngClass]="'icon-[fluent--table-lightning-24-regular]'"
                                                (click)="openNewTab(database, table)"
                                            ></span>
                                        </span>
                                    </div>

                                    <!-- Display indexes inside each table -->
                                    <div
                                        *ngIf="isOpen(database + '_tables')"
                                        class="ml-4"
                                    >
                                        <div
                                            class="flex cursor-pointer items-center"
                                            (click)="
                                                toggleSection(database + '_table_' + table + '_columns')
                                            "
                                        >
                                            <span class="mr-1">
                                                <ng-container
                                                    *ngIf="
                                                        isOpen(database + '_table_' + table + '_columns');
                                                        else closedColumns
                                                    "
                                                >
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                                    ></span>
                                                </ng-container>
                                                <ng-template #closedColumns>
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                                    ></span>
                                                </ng-template>
                                            </span>
                                            <span>Columns</span>
                                        </div>
                                        <ul
                                            *ngIf="isOpen(database + '_table_' + table + '_columns')"
                                            class="ml-4 list-none"
                                        >
                                            <!-- Iterate over table.indexes -->
                                            <li
                                                *ngFor="let column of columns['columns']"
                                                class="mb-1"
                                            >
                                                {{ column }}
                                            </li>
                                        </ul>

                                        <div
                                            class="flex cursor-pointer items-center"
                                            (click)="
                                                toggleSection(database?.name + '_table_' + table.name + '_indexes')
                                            "
                                        >
                                            <span class="mr-1">
                                                <ng-container
                                                    *ngIf="
                                                        isOpen(database?.name + '_table_' + table.name + '_indexes');
                                                        else closedIndexes
                                                    "
                                                >
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                                    ></span>
                                                </ng-container>
                                                <ng-template #closedIndexes>
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                                    ></span>
                                                </ng-template>
                                            </span>
                                            <span>Indexes</span>
                                        </div>
                                        <ul
                                            *ngIf="isOpen(database?.name + '_table_' + table.name + '_indexes')"
                                            class="ml-4 list-none"
                                        >
                                            <!-- Iterate over table.indexes -->
                                            <li
                                                *ngFor="let index of table.indexes"
                                                class="mb-1"
                                            >
                                                {{ index.index_name }}
                                            </li>
                                        </ul>

                                        <div
                                            class="flex cursor-pointer items-center"
                                            (click)="
                                                toggleSection(database?.name + '_table_' + table.name + '_foreign_keys')
                                            "
                                        >
                                            <span class="mr-1">
                                                <ng-container
                                                    *ngIf="
                                                        isOpen(
                                                            database?.name + '_table_' + table.name + '_foreign_keys'
                                                        );
                                                        else closedForeignKeys
                                                    "
                                                >
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                                    ></span>
                                                </ng-container>
                                                <ng-template #closedForeignKeys>
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                                    ></span>
                                                </ng-template>
                                            </span>
                                            <span>Foreign Keys</span>
                                        </div>
                                        <ul
                                            *ngIf="isOpen(database?.name + '_table_' + table.name + '_foreign_keys')"
                                            class="ml-4 list-none"
                                        >
                                            <!-- Iterate over table.indexes -->
                                            <li
                                                *ngFor="let foreign_key of table.foreign_keys"
                                                class="mb-1"
                                            >
                                                {{ column.foreign_key }}
                                            </li>
                                        </ul>

                                        <div
                                            class="flex cursor-pointer items-center"
                                            (click)="
                                                toggleSection(database?.name + '_table_' + table.name + '_triggers')
                                            "
                                        >
                                            <span class="mr-1">
                                                <ng-container
                                                    *ngIf="
                                                        isOpen(database?.name + '_table_' + table.name + '_triggers');
                                                        else closedTriggers
                                                    "
                                                >
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                                    ></span>
                                                </ng-container>
                                                <ng-template #closedTriggers>
                                                    <span
                                                        class="text-md mr-2"
                                                        [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                                    ></span>
                                                </ng-template>
                                            </span>
                                            <span>Triggers</span>
                                        </div>
                                        <ul
                                            *ngIf="isOpen(database?.name + '_table_' + table.name + '_triggers')"
                                            class="ml-4 list-none"
                                        >
                                            <!-- Iterate over table.indexes -->
                                            <li
                                                *ngFor="let foreign_key of table.triggers"
                                                class="mb-1"
                                            >
                                                {{ column.foreign_key }}
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Repeat similar structure for views, procedures, functions as required -->
                                </li>
                            </ul>

                            <div
                                class="flex cursor-pointer items-center"
                                (click)="toggleSection(database?.name + '_table_' + table?.name + '_views')"
                            >
                                <span class="mr-1">
                                    <ng-container
                                        *ngIf="
                                            isOpen(database?.name + '_table_' + table?.name + '_views');
                                            else closedView
                                        "
                                    >
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                        ></span>
                                    </ng-container>
                                    <ng-template #closedView>
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                        ></span>
                                    </ng-template>
                                </span>
                                <span>Views</span>
                            </div>
                            <ul
                                *ngIf="isOpen(database?.name + '_table_' + table?.name + '_views')"
                                class="ml-4 list-none"
                            >
                                <li
                                    *ngFor="let view of database?.views"
                                    class="mb-1"
                                >
                                    {{ view.name }}
                                </li>
                            </ul>

                            <div
                                class="flex cursor-pointer items-center"
                                (click)="toggleSection(database?.name + '_table_' + table?.name + '_procedures')"
                            >
                                <span class="mr-1">
                                    <ng-container
                                        *ngIf="
                                            isOpen(database?.name + '_table_' + table?.name + '_procedures');
                                            else closedProcedure
                                        "
                                    >
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                        ></span>
                                    </ng-container>
                                    <ng-template #closedProcedure>
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                        ></span>
                                    </ng-template>
                                </span>
                                <span>Stored Procedures</span>
                            </div>
                            <ul
                                *ngIf="isOpen(database?.name + '_table_' + table?.name + '_procedures')"
                                class="ml-4 list-none"
                            >
                                <li
                                    *ngFor="let procedure of database?.procedures"
                                    class="mb-1"
                                >
                                    {{ procedure.name }}
                                </li>
                            </ul>

                            <div
                                class="flex cursor-pointer items-center"
                                (click)="toggleSection(database?.name + '_table_' + table?.name + '_functions')"
                            >
                                <span class="mr-1">
                                    <ng-container
                                        *ngIf="
                                            isOpen(database?.name + '_table_' + table?.name + '_functions');
                                            else closedFunction
                                        "
                                    >
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pop--triangle-down-filled]'"
                                        ></span>
                                    </ng-container>
                                    <ng-template #closedFunction>
                                        <span
                                            class="text-md mr-2"
                                            [ngClass]="'icon-[pepicons-pencil--triangle-right-filled]'"
                                        ></span>
                                    </ng-template>
                                </span>
                                <span>Functions</span>
                            </div>
                            <ul
                                *ngIf="isOpen(database?.name + '_table_' + table?.name + '_functions')"
                                class="ml-4 list-none"
                            >
                                <li
                                    *ngFor="let function of database?.functions"
                                    class="mb-1"
                                >
                                    {{ function }}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>